// koffee 1.11.0

/*
000000000   0000000   000   000  
   000     000   000   000 000   
   000     000   000    00000    
   000     000   000     000     
   000      0000000      000
 */
var Effect, Renderer, Toy, empty, ref, slash,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), empty = ref.empty, slash = ref.slash;

Renderer = require('./renderer');

Effect = require('./effect');

Toy = (function() {
    Toy.instance = null;

    function Toy(mCanvas) {
        var devicePixelRatio;
        this.mCanvas = mCanvas;
        this.resize = bind(this.resize, this);
        this.renderLoop = bind(this.renderLoop, this);
        this.mCreated = false;
        this.mGLContext = null;
        this.mEffect = null;
        this.mStartTime = null;
        this.mIsPaused = false;
        this.mForceFrame = false;
        this.mPass = [];
        this.fpsCache = [];
        this.mActiveDoc = 0;
        devicePixelRatio = window.devicePixelRatio || 1;
        this.mCanvas.width = this.mCanvas.offsetWidth * devicePixelRatio;
        this.mCanvas.height = this.mCanvas.offsetHeight * devicePixelRatio;
        this.mStartTime = performance.now();
        this.mFrameTime = 0;
        this.mIsRendering = false;
        this.mGLContext = Renderer.createGlContext(this.mCanvas);
        if (!this.mGLContext) {
            console.error('no gl context');
        }
        this.mErrors = new Array();
        this.mEffect = new Effect(this.mGLContext, this.mCanvas.width, this.mCanvas.height);
        if (!this.mEffect.mCreated) {
            console.error('no effect');
            return;
        }
        this.mCanvas.addEventListener('webglcontextlost', function(event) {
            console.error('webgl context lost');
            return event.preventDefault();
        });
        this.load('konrad');
    }

    Toy.prototype.startRendering = function() {
        this.mIsRendering = true;
        return this.renderLoop();
    };

    Toy.prototype.renderLoop = function() {
        var deltaTime, fps, relTime, time;
        if (!this.mGLContext) {
            return;
        }
        requestAnimationFrame(this.renderLoop);
        if (this.mIsPaused && !this.mForceFrame) {
            return;
        }
        this.mForceFrame = false;
        time = performance.now();
        relTime = 0.0;
        deltaTime = 0.0;
        if (this.mIsPaused) {
            relTime = this.mFrameTime;
            deltaTime = 1000.0 / 60.0;
        } else {
            relTime = time - this.mStartTime;
            deltaTime = relTime - this.mFrameTime;
            this.mFrameTime = relTime;
        }
        this.fpsCache.push(1000.0 / deltaTime);
        if (this.fpsCache.length > 60) {
            this.fpsCache.shift();
        }
        fps = 0;
        this.fpsCache.map(function(f) {
            return fps += f;
        });
        fps /= this.fpsCache.length;
        return this.mEffect.paint(relTime / 1000.0, deltaTime / 1000.0, fps, this.mIsPaused);
    };

    Toy.prototype.resize = function() {
        var dpr;
        if (this.mCanvas) {
            dpr = window.devicePixelRatio;
            this.mCanvas.width = this.mCanvas.offsetWidth * dpr;
            this.mCanvas.height = this.mCanvas.offsetHeight * dpr;
            this.mEffect.setSize(this.mCanvas.width, this.mCanvas.height);
            return this.mForceFrame = true;
        }
    };

    Toy.prototype.logErrors = function(result) {
        if (result) {
            return console.log(result);
        }
    };

    Toy.prototype.setTexture = function(slot, url) {
        var res;
        res = this.mEffect.newTexture(this.mActiveDoc, slot, url);
        if (!res.mFailed) {
            return this.mPass[this.mActiveDoc].mDirty = res.mNeedsShaderCompile;
        }
    };

    Toy.prototype.getTexture = function(slot) {
        return this.mEffect.getTexture(this.mActiveDoc, slot);
    };

    Toy.prototype.setShaderFromEditor = function(forceall) {
        var anyErrors, i, j, k, l, m, num, recompileAll, ref1, ref2, result, shaderCode;
        anyErrors = false;
        num = this.mEffect.getNumPasses();
        recompileAll = false;
        for (i = k = 0, ref1 = num; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {
            if (this.mEffect.getPassType(i) === 'common' && (this.mPass[i].mDirty || forceall)) {
                recompileAll = true;
                break;
            }
        }
        for (j = l = 0; l < 4; j = ++l) {
            for (i = m = 0, ref2 = num; 0 <= ref2 ? m < ref2 : m > ref2; i = 0 <= ref2 ? ++m : --m) {
                if (j === 0 && this.mEffect.getPassType(i) !== 'common') {
                    continue;
                }
                if (j === 1 && this.mEffect.getPassType(i) !== 'buffer') {
                    continue;
                }
                if (j === 2 && this.mEffect.getPassType(i) !== 'cubemap') {
                    continue;
                }
                if (j === 3 && this.mEffect.getPassType(i) !== 'image') {
                    continue;
                }
                if (recompileAll || this.mPass[i].mDirty || forceall) {
                    shaderCode = this.mPass[i].mCode;
                    result = this.mEffect.newShader(shaderCode, i);
                    if (result) {
                        anyErrors = true;
                    }
                    this.mPass[i].mError = result;
                    this.mPass[i].mDirty = false;
                }
            }
        }
        this.logErrors(this.mPass[this.mActiveDoc].mError);
        if (!anyErrors) {
            if (!this.mIsRendering) {
                gToy.startRendering();
            }
            return this.mForceFrame = true;
        }
    };

    Toy.prototype.loadNew = function() {
        return this.loadPasses([
            {
                inputs: [],
                type: 'image',
                code: "void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    vec3 col = 0.1 + 0.1*cos(0.1*iTime+uv.xyx+vec3(0,2,4));\n    fragColor = vec4(col,1.0);\n}"
            }
        ]);
    };

    Toy.prototype.loadPasses = function(passes) {
        var i, k, ref1, res;
        res = this.mEffect.newScriptJSON(passes);
        this.mPass = [];
        for (i = k = 0, ref1 = res.length; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {
            this.mPass[i] = {
                mCode: res[i].mShader,
                mFailed: res[i].mFailed,
                mError: res[i].mError,
                mDirty: false
            };
        }
        this.logErrors(this.mPass[0].mError);
        return this.startRendering();
    };

    Toy.prototype.load = function(dir) {
        var file, imageFile, k, len, ref1, shader, shaderDir;
        shaderDir = slash.resolve(__dirname + "/../shader/" + dir);
        imageFile = shaderDir + "/image.frag";
        if (!slash.fileExists(imageFile)) {
            console.error("missing " + imageFile);
            return;
        }
        shader = {
            image: imageFile
        };
        ref1 = ['common', 'buffer'];
        for (k = 0, len = ref1.length; k < len; k++) {
            file = ref1[k];
            if (slash.fileExists(shaderDir + "/" + file + ".frag")) {
                shader[file] = shaderDir + "/" + file + ".frag";
            }
        }
        return this.loadShader(shader);
    };

    Toy.prototype.loadShader = function(arg) {
        var buffer, common, font, image, imageCode, keyboard, passes, ref1, ref2, ref3, ref4, ref5;
        image = (ref1 = arg.image) != null ? ref1 : null, common = (ref2 = arg.common) != null ? ref2 : null, buffer = (ref3 = arg.buffer) != null ? ref3 : null, keyboard = (ref4 = arg.keyboard) != null ? ref4 : true, font = (ref5 = arg.font) != null ? ref5 : true;
        passes = [];
        imageCode = slash.readText(image);
        if (empty(imageCode)) {
            return console.error("no image code in " + image + "?");
        }
        passes.push({
            type: 'image',
            code: imageCode,
            inputs: []
        });
        if (common) {
            passes.push({
                type: 'common',
                code: slash.readText(common)
            });
        }
        if (keyboard) {
            passes[0].inputs.push({
                channel: 0,
                id: 0,
                type: 'keyboard'
            });
            passes.push({
                type: 'image',
                url: {
                    mType: 'keyboard'
                }
            });
        }
        if (buffer) {
            passes[0].inputs.push({
                channel: 1,
                id: 'bufferA',
                type: 'buffer'
            });
            passes.push({
                type: 'buffer',
                output: 'bufferA',
                inputs: [
                    {
                        channel: 1,
                        id: 'bufferA',
                        type: 'buffer'
                    }
                ],
                code: slash.readText(buffer)
            });
            if (keyboard) {
                passes.slice(-1)[0].inputs.push({
                    channel: 0,
                    id: 0,
                    type: 'keyboard'
                });
            }
        }
        if (font) {
            passes[0].inputs.push({
                channel: 2,
                id: 2,
                type: 'texture',
                src: slash.fileUrl("../img/font.png")
            });
            passes.push({
                type: 'image',
                url: {
                    type: 'texture',
                    src: slash.fileUrl("../img/font.png")
                }
            });
        }
        return this.loadPasses(passes);
    };

    module.exports = Toy;

    return Toy;

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG95LmpzIiwic291cmNlUm9vdCI6Ii4uL2NvZmZlZSIsInNvdXJjZXMiOlsidG95LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSx3Q0FBQTtJQUFBOztBQVFBLE1BQW1CLE9BQUEsQ0FBUSxLQUFSLENBQW5CLEVBQUUsaUJBQUYsRUFBUzs7QUFFVCxRQUFBLEdBQVcsT0FBQSxDQUFRLFlBQVI7O0FBQ1gsTUFBQSxHQUFXLE9BQUEsQ0FBUSxVQUFSOztBQUVMO0lBRUYsR0FBQyxDQUFBLFFBQUQsR0FBWTs7SUFFVCxhQUFDLE9BQUQ7QUFFQyxZQUFBO1FBRkEsSUFBQyxDQUFBLFVBQUQ7OztRQUVBLElBQUMsQ0FBQSxRQUFELEdBQWU7UUFDZixJQUFDLENBQUEsVUFBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLE9BQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxVQUFELEdBQXNCO1FBQ3RCLElBQUMsQ0FBQSxTQUFELEdBQWU7UUFDZixJQUFDLENBQUEsV0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLEtBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxRQUFELEdBQWU7UUFDZixJQUFDLENBQUEsVUFBRCxHQUFlO1FBRWYsZ0JBQUEsR0FBbUIsTUFBTSxDQUFDLGdCQUFQLElBQTJCO1FBRTlDLElBQUMsQ0FBQSxPQUFPLENBQUMsS0FBVCxHQUFrQixJQUFDLENBQUEsT0FBTyxDQUFDLFdBQVQsR0FBdUI7UUFDekMsSUFBQyxDQUFBLE9BQU8sQ0FBQyxNQUFULEdBQWtCLElBQUMsQ0FBQSxPQUFPLENBQUMsWUFBVCxHQUF3QjtRQUUxQyxJQUFDLENBQUEsVUFBRCxHQUFxQixXQUFXLENBQUMsR0FBWixDQUFBO1FBQ3JCLElBQUMsQ0FBQSxVQUFELEdBQXFCO1FBQ3JCLElBQUMsQ0FBQSxZQUFELEdBQWdCO1FBRWhCLElBQUMsQ0FBQSxVQUFELEdBQWMsUUFBUSxDQUFDLGVBQVQsQ0FBeUIsSUFBQyxDQUFBLE9BQTFCO1FBRWQsSUFB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T0FBQSxFQUFRLENBQVI7d0JBQVUsRUFBQSxFQUFHLFNBQWI7d0JBQXVCLElBQUEsRUFBSyxRQUE1QjtxQkFBRDtpQkFGUjtnQkFHQSxJQUFBLEVBQU8sS0FBSyxDQUFDLFFBQU4sQ0FBZSxNQUFmLENBSFA7YUFESjtZQU1BLElBQUcsUUFBSDtnQkFDSSxNQUFPLFVBQUUsQ0FBQSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBbEIsQ0FBdUI7b0JBQUEsT0FBQSxFQUFRLENBQVI7b0JBQVUsRUFBQSxFQUFHLENBQWI7b0JBQWUsSUFBQSxFQUFLLFVBQXBCO2lCQUF2QixFQURKO2FBUko7O1FBV0EsSUFBRyxJQUFIO1lBQ0ksTUFBTyxDQUFBLENBQUEsQ0FBRSxDQUFDLE1BQU0sQ0FBQyxJQUFqQixDQUFzQjtnQkFBQSxPQUFBLEVBQVEsQ0FBUjtnQkFBVSxFQUFBLEVBQUcsQ0FBYjtnQkFBZSxJQUFBLEVBQUssU0FBcEI7Z0JBQThCLEdBQUEsRUFBSSxLQUFLLENBQUMsT0FBTixDQUFjLGlCQUFkLENBQWxDO2FBQXRCO1lBQ0EsTUFBTSxDQUFDLElBQVAsQ0FDSTtnQkFBQSxJQUFBLEVBQU8sT0FBUDtnQkFDQSxHQUFBLEVBQ0k7b0JBQUEsSUFBQSxFQUFNLFNBQU47b0JBQ0EsR0FBQSxFQUFNLEtBQUssQ0FBQyxPQUFOLENBQWMsaUJBQWQsQ0FETjtpQkFGSjthQURKLEVBRko7O2VBUUEsSUFBQyxDQUFBLFVBQUQsQ0FBWSxNQUFaO0lBM0NROztJQTZDWixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAwMDAgICAgIDAwMCAgIDAwMCAgIDAwMCAwMDAgICBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAgIDAwMDAwICAgIFxuICAgMDAwICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAwMDAgICAgICAwMDAwMDAwICAgICAgMDAwICAgICBcbiMjI1xuXG57IGVtcHR5LCBzbGFzaCB9ID0gcmVxdWlyZSAna3hrJ1xuXG5SZW5kZXJlciA9IHJlcXVpcmUgJy4vcmVuZGVyZXInXG5FZmZlY3QgICA9IHJlcXVpcmUgJy4vZWZmZWN0J1xuXG5jbGFzcyBUb3lcblxuICAgIEBpbnN0YW5jZSA9IG51bGxcbiAgICBcbiAgICBAOiAoQG1DYW52YXMpIC0+XG5cbiAgICAgICAgQG1DcmVhdGVkICAgID0gZmFsc2VcbiAgICAgICAgQG1HTENvbnRleHQgID0gbnVsbFxuICAgICAgICBAbUVmZmVjdCAgICAgPSBudWxsXG4gICAgICAgIEBtU3RhcnRUaW1lICAgICAgICAgPSBudWxsXG4gICAgICAgIEBtSXNQYXVzZWQgICA9IGZhbHNlXG4gICAgICAgIEBtRm9yY2VGcmFtZSA9IGZhbHNlXG4gICAgICAgIEBtUGFzcyAgICAgICA9IFtdXG4gICAgICAgIEBmcHNDYWNoZSAgICA9IFtdXG4gICAgICAgIEBtQWN0aXZlRG9jICA9IDBcbiAgICBcbiAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbyA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIG9yIDFcbiAgICBcbiAgICAgICAgQG1DYW52YXMud2lkdGggID0gQG1DYW52YXMub2Zmc2V0V2lkdGggKiBkZXZpY2VQaXhlbFJhdGlvXG4gICAgICAgIEBtQ2FudmFzLmhlaWdodCA9IEBtQ2FudmFzLm9mZnNldEhlaWdodCAqIGRldmljZVBpeGVsUmF0aW9cbiAgICBcbiAgICAgICAgQG1TdGFydFRpbWUgICAgICAgID0gcGVyZm9ybWFuY2Uubm93KClcbiAgICAgICAgQG1GcmFtZVRpbWUgICAgICAgID0gMFxuICAgICAgICBAbUlzUmVuZGVyaW5nID0gZmFsc2VcbiAgICBcbiAgICAgICAgQG1HTENvbnRleHQgPSBSZW5kZXJlci5jcmVhdGVHbENvbnRleHQgQG1DYW52YXNcbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBAbUdMQ29udGV4dFxuICAgICAgICAgICAgZXJyb3IgJ25vIGdsIGNvbnRleHQnXG4gICAgXG4gICAgICAgIEBtRXJyb3JzID0gbmV3IEFycmF5KClcbiAgICAgICAgXG4gICAgICAgIEBtRWZmZWN0ID0gbmV3IEVmZmVjdCBAbUdMQ29udGV4dCwgQG1DYW52YXMud2lkdGgsIEBtQ2FudmFzLmhlaWdodFxuICAgICAgICBpZiBub3QgQG1FZmZlY3QubUNyZWF0ZWRcbiAgICAgICAgICAgIGVycm9yICdubyBlZmZlY3QnXG4gICAgICAgICAgICByZXR1cm5cbiAgICBcbiAgICAgICAgQG1DYW52YXMuYWRkRXZlbnRMaXN0ZW5lciAnd2ViZ2xjb250ZXh0bG9zdCcgKGV2ZW50KSAtPlxuICAgICAgICAgICAgZXJyb3IgJ3dlYmdsIGNvbnRleHQgbG9zdCdcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgXG4gICAgICAgICMgQGxvYWROZXcoKVxuICAgICAgICAjIEBsb2FkICdnbG93b3JtJ1xuICAgICAgICAjIEBsb2FkICdrYWxhbWFyaSdcbiAgICAgICAgIyBAbG9hZCAndmV5ZXJ1cydcbiAgICAgICAgIyBAbG9hZCAnaGV4aXNsZSdcbiAgICAgICAgIyBAbG9hZCAndm9yb25veSdcbiAgICAgICAgIyBAbG9hZCAna3JhcCdcbiAgICAgICAgIyBAbG9hZCAna2VybCdcbiAgICAgICAgIyBAbG9hZCAnYXJteSdcbiAgICAgICAgIyBAbG9hZCAnYXN0cm8nXG4gICAgICAgICMgQGxvYWQgJ2JvaWRzJ1xuICAgICAgICAjIEBsb2FkICdleWVib2lkcydcbiAgICAgICAgIyBAbG9hZCAnYnVmZmVydGVzdCdcbiAgICAgICAgIyBAbG9hZCAnc25vd21vYmlsZSdcbiAgICAgICAgIyBAbG9hZCAnY29tbW9uJ1xuICAgICAgICAjIEBsb2FkICdza3VsbCdcbiAgICAgICAgIyBAbG9hZCAna25pZ2h0eSdcbiAgICAgICAgQGxvYWQgJ2tvbnJhZCdcblxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgIFxuICAgIHN0YXJ0UmVuZGVyaW5nOiAtPlxuXG4gICAgICAgIEBtSXNSZW5kZXJpbmcgPSB0cnVlXG4gICAgICAgIEByZW5kZXJMb29wKClcbiAgICBcbiAgICByZW5kZXJMb29wOiA9PlxuICAgICAgICBcbiAgICAgICAgaWYgbm90IEBtR0xDb250ZXh0IHRoZW4gcmV0dXJuXG5cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIEByZW5kZXJMb29wXG5cbiAgICAgICAgaWYgQG1Jc1BhdXNlZCBhbmQgbm90IEBtRm9yY2VGcmFtZVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICBcbiAgICAgICAgQG1Gb3JjZUZyYW1lID0gZmFsc2VcblxuICAgICAgICB0aW1lID0gcGVyZm9ybWFuY2Uubm93KClcblxuICAgICAgICByZWxUaW1lID0gMC4wXG4gICAgICAgIGRlbHRhVGltZSA9IDAuMFxuICAgICAgICBpZiBAbUlzUGF1c2VkXG4gICAgICAgICAgICByZWxUaW1lID0gQG1GcmFtZVRpbWVcbiAgICAgICAgICAgIGRlbHRhVGltZSA9IDEwMDAuMCAvIDYwLjBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmVsVGltZSA9IHRpbWUgLSBAbVN0YXJ0VGltZVxuICAgICAgICAgICAgZGVsdGFUaW1lID0gcmVsVGltZSAtIEBtRnJhbWVUaW1lIFxuICAgICAgICAgICAgQG1GcmFtZVRpbWUgPSByZWxUaW1lXG5cbiAgICAgICAgQGZwc0NhY2hlLnB1c2ggMTAwMC4wL2RlbHRhVGltZVxuICAgICAgICBpZiBAZnBzQ2FjaGUubGVuZ3RoID4gNjAgdGhlbiBAZnBzQ2FjaGUuc2hpZnQoKVxuICAgICAgICBcbiAgICAgICAgZnBzID0gMFxuICAgICAgICBAZnBzQ2FjaGUubWFwIChmKSAtPiBmcHMgKz0gZlxuICAgICAgICBmcHMgLz0gQGZwc0NhY2hlLmxlbmd0aFxuICAgICAgICBAbUVmZmVjdC5wYWludCByZWxUaW1lLzEwMDAuMCwgZGVsdGFUaW1lLzEwMDAuMCwgZnBzLCBAbUlzUGF1c2VkIFxuXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAwMDAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgIDAwMCAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgcmVzaXplOiA9PlxuICAgICAgICBcbiAgICAgICAgaWYgQG1DYW52YXNcbiAgICAgICAgICAgIGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvXG4gICAgICAgICAgICBAbUNhbnZhcy53aWR0aCAgPSBAbUNhbnZhcy5vZmZzZXRXaWR0aCAgKiBkcHJcbiAgICAgICAgICAgIEBtQ2FudmFzLmhlaWdodCA9IEBtQ2FudmFzLm9mZnNldEhlaWdodCAqIGRwclxuICAgICAgICAgICAgQG1FZmZlY3Quc2V0U2l6ZSBAbUNhbnZhcy53aWR0aCwgQG1DYW52YXMuaGVpZ2h0XG4gICAgICAgICAgICBAbUZvcmNlRnJhbWUgPSB0cnVlXG5cbiAgICBsb2dFcnJvcnM6IChyZXN1bHQpIC0+IGxvZyByZXN1bHQgaWYgcmVzdWx0XG5cbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgICMgICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAgICAwMDAgICAgIDAwMDAwMDAgICAgIDAwMDAwICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAgICBcbiAgICAjICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgc2V0VGV4dHVyZTogKHNsb3QsIHVybCkgLT5cblxuICAgICAgICByZXMgPSBAbUVmZmVjdC5uZXdUZXh0dXJlIEBtQWN0aXZlRG9jLCBzbG90LCB1cmxcbiAgICAgICAgaWYgbm90IHJlcy5tRmFpbGVkXG4gICAgICAgICAgICBAbVBhc3NbQG1BY3RpdmVEb2NdLm1EaXJ0eSA9IHJlcy5tTmVlZHNTaGFkZXJDb21waWxlXG5cbiAgICBnZXRUZXh0dXJlOiAoc2xvdCkgLT5cbiAgICAgICAgQG1FZmZlY3QuZ2V0VGV4dHVyZSggQG1BY3RpdmVEb2MsIHNsb3QgKVxuXG4gICAgc2V0U2hhZGVyRnJvbUVkaXRvcjogKGZvcmNlYWxsKSAtPlxuXG4gICAgICAgIGFueUVycm9ycyA9IGZhbHNlXG5cbiAgICAgICAgbnVtID0gQG1FZmZlY3QuZ2V0TnVtUGFzc2VzKClcblxuICAgICAgICByZWNvbXBpbGVBbGwgPSBmYWxzZVxuICAgICAgICBmb3IgaSBpbiBbMC4uLm51bV1cbiAgICAgICAgICAgIGlmIEBtRWZmZWN0LmdldFBhc3NUeXBlKGkpID09ICdjb21tb24nIGFuZCAoQG1QYXNzW2ldLm1EaXJ0eSBvciBmb3JjZWFsbClcbiAgICAgICAgICAgICAgICByZWNvbXBpbGVBbGwgPSB0cnVlXG4gICAgICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICBmb3IgaiBpbiBbMC4uLjRdXG4gICAgICAgICAgICBmb3IgaSBpbiBbMC4uLm51bV1cbiAgICAgICAgICAgICAgICBpZiBqID09IDAgYW5kIEBtRWZmZWN0LmdldFBhc3NUeXBlKGkpICE9ICdjb21tb24nICAgdGhlbiBjb250aW51ZVxuICAgICAgICAgICAgICAgIGlmIGogPT0gMSBhbmQgQG1FZmZlY3QuZ2V0UGFzc1R5cGUoaSkgIT0gJ2J1ZmZlcicgICB0aGVuIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgaWYgaiA9PSAyIGFuZCBAbUVmZmVjdC5nZXRQYXNzVHlwZShpKSAhPSAnY3ViZW1hcCcgIHRoZW4gY29udGludWVcbiAgICAgICAgICAgICAgICBpZiBqID09IDMgYW5kIEBtRWZmZWN0LmdldFBhc3NUeXBlKGkpICE9ICdpbWFnZScgICAgdGhlbiBjb250aW51ZVxuXG4gICAgICAgICAgICAgICAgaWYgcmVjb21waWxlQWxsIG9yIEBtUGFzc1tpXS5tRGlydHkgb3IgZm9yY2VhbGxcbiAgICAgICAgICAgICAgICAgICAgc2hhZGVyQ29kZSA9IEBtUGFzc1tpXS5tQ29kZVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBAbUVmZmVjdC5uZXdTaGFkZXIgc2hhZGVyQ29kZSwgaVxuICAgICAgICAgICAgICAgICAgICBpZiByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgIGFueUVycm9ycyA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgQG1QYXNzW2ldLm1FcnJvciA9IHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICBAbVBhc3NbaV0ubURpcnR5ID0gZmFsc2VcblxuICAgICAgICBAbG9nRXJyb3JzIEBtUGFzc1tAbUFjdGl2ZURvY10ubUVycm9yXG5cbiAgICAgICAgaWYgbm90IGFueUVycm9yc1xuICAgICAgICAgICAgaWYgbm90IEBtSXNSZW5kZXJpbmdcbiAgICAgICAgICAgICAgICBnVG95LnN0YXJ0UmVuZGVyaW5nKClcbiAgICAgICAgICAgIEBtRm9yY2VGcmFtZSA9IHRydWVcblxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAwIDAwMCAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwICAgICAwMCAgXG4gICAgXG4gICAgbG9hZE5ldzogLT5cbiAgICAgICAgQGxvYWRQYXNzZXMgW3tcbiAgICAgICAgICAgIGlucHV0czogIFtdXG4gICAgICAgICAgICB0eXBlOiAgICAnaW1hZ2UnXG4gICAgICAgICAgICBjb2RlOiBcIlwiXCJcbiAgICAgICAgICAgICAgICB2b2lkIG1haW5JbWFnZSggb3V0IHZlYzQgZnJhZ0NvbG9yLCBpbiB2ZWMyIGZyYWdDb29yZCApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2ZWMyIHV2ID0gZnJhZ0Nvb3JkL2lSZXNvbHV0aW9uLnh5O1xuICAgICAgICAgICAgICAgICAgICB2ZWMzIGNvbCA9IDAuMSArIDAuMSpjb3MoMC4xKmlUaW1lK3V2Lnh5eCt2ZWMzKDAsMiw0KSk7XG4gICAgICAgICAgICAgICAgICAgIGZyYWdDb2xvciA9IHZlYzQoY29sLDEuMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFwiXCJcIlxuICAgICAgICB9XVxuICAgIFxuICAgIGxvYWRQYXNzZXM6IChwYXNzZXMpIC0+XG4gICAgICAgIFxuICAgICAgICByZXMgPSBAbUVmZmVjdC5uZXdTY3JpcHRKU09OIHBhc3Nlc1xuICAgICAgICBcbiAgICAgICAgIyBrbG9nICdwYXNzZXMnIHBhc3Nlc1xuICAgICAgICBcbiAgICAgICAgQG1QYXNzID0gW11cbiAgICAgICAgXG4gICAgICAgIGZvciBpIGluIFswLi4ucmVzLmxlbmd0aF1cbiAgICAgICAgICAgIEBtUGFzc1tpXSA9IFxuICAgICAgICAgICAgICAgIG1Db2RlOiAgIHJlc1tpXS5tU2hhZGVyXG4gICAgICAgICAgICAgICAgbUZhaWxlZDogcmVzW2ldLm1GYWlsZWRcbiAgICAgICAgICAgICAgICBtRXJyb3I6ICByZXNbaV0ubUVycm9yXG4gICAgICAgICAgICAgICAgbURpcnR5OiAgZmFsc2VcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQGxvZ0Vycm9ycyBAbVBhc3NbMF0ubUVycm9yXG4gICAgICAgIEBzdGFydFJlbmRlcmluZygpXG4gICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBsb2FkOiAoZGlyKSAtPlxuICAgICAgICBzaGFkZXJEaXIgPSBzbGFzaC5yZXNvbHZlIFwiI3tfX2Rpcm5hbWV9Ly4uL3NoYWRlci8je2Rpcn1cIlxuICAgICAgICBpbWFnZUZpbGUgPSBcIiN7c2hhZGVyRGlyfS9pbWFnZS5mcmFnXCJcbiAgICAgICAgaWYgbm90IHNsYXNoLmZpbGVFeGlzdHMgaW1hZ2VGaWxlXG4gICAgICAgICAgICBlcnJvciBcIm1pc3NpbmcgI3tpbWFnZUZpbGV9XCJcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICBzaGFkZXIgPSBpbWFnZTppbWFnZUZpbGVcbiAgICAgICAgZm9yIGZpbGUgaW4gWydjb21tb24nICdidWZmZXInXVxuICAgICAgICAgICAgaWYgc2xhc2guZmlsZUV4aXN0cyBcIiN7c2hhZGVyRGlyfS8je2ZpbGV9LmZyYWdcIlxuICAgICAgICAgICAgICAgIHNoYWRlcltmaWxlXSA9IFwiI3tzaGFkZXJEaXJ9LyN7ZmlsZX0uZnJhZ1wiXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICMga2xvZyAnbG9hZGluZyBzaGFkZXIgZGlyJyBzaGFkZXJcbiAgICAgICAgQGxvYWRTaGFkZXIgc2hhZGVyXG4gICAgXG4gICAgbG9hZFNoYWRlcjogKGltYWdlOiwgY29tbW9uOiwgYnVmZmVyOiwga2V5Ym9hcmQ6dHJ1ZSwgZm9udDp0cnVlKSAtPlxuICAgICAgICBcbiAgICAgICAgcGFzc2VzID0gW11cbiAgICAgICAgXG4gICAgICAgIGltYWdlQ29kZSA9IHNsYXNoLnJlYWRUZXh0IGltYWdlXG4gICAgICAgIGlmIGVtcHR5IGltYWdlQ29kZVxuICAgICAgICAgICAgcmV0dXJuIGVycm9yIFwibm8gaW1hZ2UgY29kZSBpbiAje2ltYWdlfT9cIlxuICAgICAgICBcbiAgICAgICAgcGFzc2VzLnB1c2hcbiAgICAgICAgICAgIHR5cGU6ICAgICdpbWFnZSdcbiAgICAgICAgICAgIGNvZGU6ICAgIGltYWdlQ29kZVxuICAgICAgICAgICAgaW5wdXRzOiAgW11cbiAgICAgICAgICAgIFxuICAgICAgICBpZiBjb21tb25cbiAgICAgICAgICAgIHBhc3Nlcy5wdXNoXG4gICAgICAgICAgICAgICAgdHlwZTogJ2NvbW1vbidcbiAgICAgICAgICAgICAgICBjb2RlOiBzbGFzaC5yZWFkVGV4dCBjb21tb25cbiAgICAgICAgICAgIFxuICAgICAgICBpZiBrZXlib2FyZFxuICAgICAgICAgICAgcGFzc2VzWzBdLmlucHV0cy5wdXNoIGNoYW5uZWw6MCBpZDowIHR5cGU6J2tleWJvYXJkJ1xuICAgICAgICAgICAgcGFzc2VzLnB1c2ggXG4gICAgICAgICAgICAgICAgdHlwZTogJ2ltYWdlJ1xuICAgICAgICAgICAgICAgIHVybDogbVR5cGU6ICdrZXlib2FyZCdcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgaWYgYnVmZmVyXG4gICAgICAgICAgICBwYXNzZXNbMF0uaW5wdXRzLnB1c2ggY2hhbm5lbDoxIGlkOididWZmZXJBJyB0eXBlOididWZmZXInXG4gICAgICAgICAgICBwYXNzZXMucHVzaFxuICAgICAgICAgICAgICAgIHR5cGU6ICAgJ2J1ZmZlcidcbiAgICAgICAgICAgICAgICBvdXRwdXQ6ICdidWZmZXJBJ1xuICAgICAgICAgICAgICAgIGlucHV0czogW2NoYW5uZWw6MSBpZDonYnVmZmVyQScgdHlwZTonYnVmZmVyJ11cbiAgICAgICAgICAgICAgICBjb2RlOiAgc2xhc2gucmVhZFRleHQgYnVmZmVyXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBrZXlib2FyZFxuICAgICAgICAgICAgICAgIHBhc3Nlc1stMV0uaW5wdXRzLnB1c2ggY2hhbm5lbDowIGlkOjAgdHlwZTona2V5Ym9hcmQnXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIGlmIGZvbnRcbiAgICAgICAgICAgIHBhc3Nlc1swXS5pbnB1dHMucHVzaCBjaGFubmVsOjIgaWQ6MiB0eXBlOid0ZXh0dXJlJyBzcmM6c2xhc2guZmlsZVVybCBcIi4uL2ltZy9mb250LnBuZ1wiXG4gICAgICAgICAgICBwYXNzZXMucHVzaCBcbiAgICAgICAgICAgICAgICB0eXBlOiAgJ2ltYWdlJ1xuICAgICAgICAgICAgICAgIHVybDpcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHR1cmUnXG4gICAgICAgICAgICAgICAgICAgIHNyYzogIHNsYXNoLmZpbGVVcmwgXCIuLi9pbWcvZm9udC5wbmdcIlxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAbG9hZFBhc3NlcyBwYXNzZXNcbiAgICAgICAgXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBUb3lcbiAgICAiXX0=
//# sourceURL=../coffee/toy.coffee