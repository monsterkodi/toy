// koffee 1.6.0

/*
000000000   0000000   000   000  
   000     000   000   000 000   
   000     000   000    00000    
   000     000   000     000     
   000      0000000      000
 */
var Effect, Renderer, Toy, empty, klog, ref, slash,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), empty = ref.empty, klog = ref.klog, slash = ref.slash;

Renderer = require('./renderer');

Effect = require('./effect');

Toy = (function() {
    Toy.instance = null;

    function Toy(mCanvas) {
        var devicePixelRatio;
        this.mCanvas = mCanvas;
        this.resize = bind(this.resize, this);
        this.renderLoop = bind(this.renderLoop, this);
        this.mCreated = false;
        this.mGLContext = null;
        this.mEffect = null;
        this.mTo = null;
        this.mIsPaused = false;
        this.mForceFrame = false;
        this.mPass = [];
        this.mActiveDoc = 0;
        devicePixelRatio = window.devicePixelRatio || 1;
        this.mCanvas.width = this.mCanvas.offsetWidth * devicePixelRatio;
        this.mCanvas.height = this.mCanvas.offsetHeight * devicePixelRatio;
        this.mTo = performance.now();
        this.mTf = 0;
        this.mRestarted = true;
        this.mIsRendering = false;
        this.mGLContext = Renderer.createGlContext(this.mCanvas);
        if (!this.mGLContext) {
            console.error('no gl context');
        }
        this.mErrors = new Array();
        this.mEffect = new Effect(this.mGLContext, this.mCanvas.width, this.mCanvas.height);
        if (!this.mEffect.mCreated) {
            console.error('no effect');
            return;
        }
        this.mCanvas.addEventListener('webglcontextlost', function(event) {
            console.error('webgl context lost');
            return event.preventDefault();
        });
        this.load('astro');
    }

    Toy.prototype.startRendering = function() {
        this.mIsRendering = true;
        return this.renderLoop();
    };

    Toy.prototype.renderLoop = function() {
        var dtime, ltime, time;
        if (!this.mGLContext) {
            return;
        }
        requestAnimationFrame(this.renderLoop);
        if (this.mIsPaused && !this.mForceFrame) {
            return;
        }
        this.mForceFrame = false;
        time = performance.now();
        ltime = 0.0;
        dtime = 0.0;
        if (this.mIsPaused) {
            ltime = this.mTf;
            dtime = 1000.0 / 60.0;
        } else {
            ltime = time - this.mTo;
            if (this.mRestarted) {
                dtime = 1000.0 / 60.0;
            } else {
                dtime = ltime - this.mTf;
            }
            this.mTf = ltime;
        }
        this.mRestarted = false;
        return this.mEffect.paint(ltime / 1000.0, dtime / 1000.0, 60, this.mIsPaused);
    };

    Toy.prototype.resize = function(xres, yres) {
        if (this.mCanvas) {
            this.mCanvas.width = this.mCanvas.offsetWidth;
            this.mCanvas.height = this.mCanvas.offsetHeight;
            this.mEffect.setSize(this.mCanvas.width, this.mCanvas.height);
            return this.mForceFrame = true;
        }
    };

    Toy.prototype.logErrors = function(result) {
        if (result) {
            return console.log(result);
        }
    };

    Toy.prototype.setTexture = function(slot, url) {
        var res;
        res = this.mEffect.newTexture(this.mActiveDoc, slot, url);
        if (!res.mFailed) {
            return this.mPass[this.mActiveDoc].mDirty = res.mNeedsShaderCompile;
        }
    };

    Toy.prototype.getTexture = function(slot) {
        return this.mEffect.getTexture(this.mActiveDoc, slot);
    };

    Toy.prototype.setShaderFromEditor = function(forceall) {
        var anyErrors, i, j, k, l, m, num, recompileAll, ref1, ref2, result, shaderCode;
        anyErrors = false;
        num = this.mEffect.getNumPasses();
        recompileAll = false;
        for (i = k = 0, ref1 = num; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {
            if (this.mEffect.getPassType(i) === 'common' && (this.mPass[i].mDirty || forceall)) {
                recompileAll = true;
                break;
            }
        }
        for (j = l = 0; l < 4; j = ++l) {
            for (i = m = 0, ref2 = num; 0 <= ref2 ? m < ref2 : m > ref2; i = 0 <= ref2 ? ++m : --m) {
                if (j === 0 && this.mEffect.getPassType(i) !== 'common') {
                    continue;
                }
                if (j === 1 && this.mEffect.getPassType(i) !== 'buffer') {
                    continue;
                }
                if (j === 2 && this.mEffect.getPassType(i) !== 'cubemap') {
                    continue;
                }
                if (j === 3 && this.mEffect.getPassType(i) !== 'image') {
                    continue;
                }
                if (recompileAll || this.mPass[i].mDirty || forceall) {
                    shaderCode = this.mPass[i].mCode;
                    result = this.mEffect.newShader(shaderCode, i);
                    if (result) {
                        anyErrors = true;
                    }
                    this.mPass[i].mError = result;
                    this.mPass[i].mDirty = false;
                }
            }
        }
        this.logErrors(this.mPass[this.mActiveDoc].mError);
        if (!anyErrors) {
            if (!this.mIsRendering) {
                gToy.startRendering();
            }
            return this.mForceFrame = true;
        }
    };

    Toy.prototype.loadNew = function() {
        return this.loadPasses([
            {
                inputs: [],
                type: 'image',
                code: "void mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 uv = fragCoord/iResolution.xy;\n    vec3 col = 0.1 + 0.1*cos(0.1*iTime+uv.xyx+vec3(0,2,4));\n    fragColor = vec4(col,1.0);\n}"
            }
        ]);
    };

    Toy.prototype.loadPasses = function(passes) {
        var i, k, ref1, res;
        res = this.mEffect.newScriptJSON(passes);
        this.mPass = [];
        for (i = k = 0, ref1 = res.length; 0 <= ref1 ? k < ref1 : k > ref1; i = 0 <= ref1 ? ++k : --k) {
            this.mPass[i] = {
                mCode: res[i].mShader,
                mFailed: res[i].mFailed,
                mError: res[i].mError,
                mDirty: false
            };
        }
        this.logErrors(this.mPass[0].mError);
        return this.startRendering();
    };

    Toy.prototype.load = function(dir) {
        var file, imageFile, k, len, ref1, shader, shaderDir;
        shaderDir = slash.resolve(__dirname + "/../shader/" + dir);
        imageFile = shaderDir + "/image.frag";
        if (!slash.fileExists(imageFile)) {
            return;
        }
        shader = {
            image: imageFile
        };
        ref1 = ['common', 'buffer'];
        for (k = 0, len = ref1.length; k < len; k++) {
            file = ref1[k];
            if (slash.fileExists(shaderDir + "/" + file + ".frag")) {
                shader[file] = shaderDir + "/" + file + ".frag";
            }
        }
        klog('loading shader dir', shader);
        return this.loadShader(shader);
    };

    Toy.prototype.loadShader = function(arg) {
        var buffer, common, font, image, imageCode, keyboard, passes, ref1, ref2, ref3, ref4, ref5;
        image = (ref1 = arg.image) != null ? ref1 : null, common = (ref2 = arg.common) != null ? ref2 : null, buffer = (ref3 = arg.buffer) != null ? ref3 : null, keyboard = (ref4 = arg.keyboard) != null ? ref4 : true, font = (ref5 = arg.font) != null ? ref5 : true;
        passes = [];
        imageCode = slash.readText(image);
        if (empty(imageCode)) {
            return console.error("no image code in " + image + "?");
        }
        passes.push({
            type: 'image',
            code: imageCode,
            inputs: []
        });
        if (common) {
            passes.push({
                type: 'common',
                code: slash.readText(common)
            });
        }
        if (keyboard) {
            passes[0].inputs.push({
                channel: 0,
                id: 0,
                type: 'keyboard'
            });
            passes.push({
                type: 'image',
                url: {
                    mType: 'keyboard'
                }
            });
        }
        if (buffer) {
            passes[0].inputs.push({
                channel: 1,
                id: 'bufferA',
                type: 'buffer'
            });
            passes.push({
                type: 'buffer',
                output: 'bufferA',
                code: slash.readText(buffer)
            });
        }
        if (font) {
            passes[0].inputs.push({
                channel: 2,
                id: 2,
                type: 'texture',
                src: slash.fileUrl("../img/font.png")
            });
            passes.push({
                type: 'image',
                url: {
                    type: 'texture',
                    src: slash.fileUrl("../img/font.png")
                }
            });
        }
        return this.loadPasses(passes);
    };

    module.exports = Toy;

    return Toy;

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG95LmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSw4Q0FBQTtJQUFBOztBQVFBLE1BQXlCLE9BQUEsQ0FBUSxLQUFSLENBQXpCLEVBQUUsaUJBQUYsRUFBUyxlQUFULEVBQWU7O0FBRWYsUUFBQSxHQUFXLE9BQUEsQ0FBUSxZQUFSOztBQUNYLE1BQUEsR0FBVyxPQUFBLENBQVEsVUFBUjs7QUFFTDtJQUVGLEdBQUMsQ0FBQSxRQUFELEdBQVk7O0lBRVQsYUFBQyxPQUFEO0FBRUMsWUFBQTtRQUZBLElBQUMsQ0FBQSxVQUFEOzs7UUFFQSxJQUFDLENBQUEsUUFBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLFVBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxPQUFELEdBQWU7UUFDZixJQUFDLENBQUEsR0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLFNBQUQsR0FBZTtRQUNmLElBQUMsQ0FBQSxXQUFELEdBQWU7UUFDZixJQUFDLENBQUEsS0FBRCxHQUFlO1FBQ2YsSUFBQyxDQUFBLFVBQUQsR0FBZTtRQUVmLGdCQUFBLEdBQW1CLE1BQU0sQ0FBQyxnQkFBUCxJQUEyQjtRQUU5QyxJQUFDLENBQUEsT0FBTyxDQUFDLEtBQVQsR0FBa0IsSUFBQyxDQUFBLE9BQU8sQ0FBQyxXQUFULEdBQXVCO1FBQ3pDLElBQUMsQ0FBQSxPQUFPLENBQUMsTUFBVCxHQUFrQixJQUFDLENBQUEsT0FBTyxDQUFDLFlBQVQsR0FBd0I7UUFFMUMsSUFBQyxDQUFBLEdBQUQsR0FBYyxXQUFXLENBQUMsR0FBWixDQUFBO1FBQ2QsSUFBQyxDQUFBLEdBQUQsR0FBYztRQUNkLElBQUMsQ0FBQSxVQUFELEdBQWM7UUFDZCxJQUFDLENBQUEsWUFBRCxHQUFnQjtRQUVoQixJQUFDLENBQUEsVUFBRCxHQUFjLFFBQVEsQ0FBQyxlQUFULENBQXlCLElBQUMsQ0FBQSxPQUExQjtRQUVkLElBQUcsQ0FBSSxJQUFDLENB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LElBQVAsQ0FDSTtnQkFBQSxJQUFBLEVBQU8sT0FBUDtnQkFDQSxHQUFBLEVBQ0k7b0JBQUEsSUFBQSxFQUFNLFNBQU47b0JBQ0EsR0FBQSxFQUFNLEtBQUssQ0FBQyxPQUFOLENBQWMsaUJBQWQsQ0FETjtpQkFGSjthQURKLEVBRko7O2VBUUEsSUFBQyxDQUFBLFVBQUQsQ0FBWSxNQUFaO0lBdkNROztJQXlDWixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAwMDAgICAgIDAwMCAgIDAwMCAgIDAwMCAwMDAgICBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAgIDAwMDAwICAgIFxuICAgMDAwICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAwMDAgICAgICAwMDAwMDAwICAgICAgMDAwICAgICBcbiMjI1xuXG57IGVtcHR5LCBrbG9nLCBzbGFzaCB9ID0gcmVxdWlyZSAna3hrJ1xuXG5SZW5kZXJlciA9IHJlcXVpcmUgJy4vcmVuZGVyZXInXG5FZmZlY3QgICA9IHJlcXVpcmUgJy4vZWZmZWN0J1xuXG5jbGFzcyBUb3lcblxuICAgIEBpbnN0YW5jZSA9IG51bGxcbiAgICBcbiAgICBAOiAoQG1DYW52YXMpIC0+XG5cbiAgICAgICAgQG1DcmVhdGVkICAgID0gZmFsc2VcbiAgICAgICAgQG1HTENvbnRleHQgID0gbnVsbFxuICAgICAgICBAbUVmZmVjdCAgICAgPSBudWxsXG4gICAgICAgIEBtVG8gICAgICAgICA9IG51bGxcbiAgICAgICAgQG1Jc1BhdXNlZCAgID0gZmFsc2VcbiAgICAgICAgQG1Gb3JjZUZyYW1lID0gZmFsc2VcbiAgICAgICAgQG1QYXNzICAgICAgID0gW11cbiAgICAgICAgQG1BY3RpdmVEb2MgID0gMFxuICAgIFxuICAgICAgICBkZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gb3IgMVxuICAgIFxuICAgICAgICBAbUNhbnZhcy53aWR0aCAgPSBAbUNhbnZhcy5vZmZzZXRXaWR0aCAqIGRldmljZVBpeGVsUmF0aW9cbiAgICAgICAgQG1DYW52YXMuaGVpZ2h0ID0gQG1DYW52YXMub2Zmc2V0SGVpZ2h0ICogZGV2aWNlUGl4ZWxSYXRpb1xuICAgIFxuICAgICAgICBAbVRvICAgICAgICA9IHBlcmZvcm1hbmNlLm5vdygpXG4gICAgICAgIEBtVGYgICAgICAgID0gMFxuICAgICAgICBAbVJlc3RhcnRlZCA9IHRydWVcbiAgICAgICAgQG1Jc1JlbmRlcmluZyA9IGZhbHNlXG4gICAgXG4gICAgICAgIEBtR0xDb250ZXh0ID0gUmVuZGVyZXIuY3JlYXRlR2xDb250ZXh0IEBtQ2FudmFzXG4gICAgICAgIFxuICAgICAgICBpZiBub3QgQG1HTENvbnRleHRcbiAgICAgICAgICAgIGVycm9yICdubyBnbCBjb250ZXh0J1xuICAgIFxuICAgICAgICBAbUVycm9ycyA9IG5ldyBBcnJheSgpXG4gICAgICAgIFxuICAgICAgICBAbUVmZmVjdCA9IG5ldyBFZmZlY3QgQG1HTENvbnRleHQsIEBtQ2FudmFzLndpZHRoLCBAbUNhbnZhcy5oZWlnaHRcbiAgICAgICAgaWYgbm90IEBtRWZmZWN0Lm1DcmVhdGVkXG4gICAgICAgICAgICBlcnJvciAnbm8gZWZmZWN0J1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgXG4gICAgICAgIEBtQ2FudmFzLmFkZEV2ZW50TGlzdGVuZXIgJ3dlYmdsY29udGV4dGxvc3QnIChldmVudCkgLT5cbiAgICAgICAgICAgIGVycm9yICd3ZWJnbCBjb250ZXh0IGxvc3QnXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgIFxuICAgICAgICAjIEBsb2FkTmV3KClcbiAgICAgICAgIyBAbG9hZCAnZ2xvd29ybSdcbiAgICAgICAgIyBAbG9hZCAnZXllYm9pZHMnXG4gICAgICAgICMgQGxvYWQgJ3Nub3dtb2JpbGUnXG4gICAgICAgICMgQGxvYWQgJ2thbGFtYXJpJ1xuICAgICAgICAjIEBsb2FkICd2ZXllcnVzJ1xuICAgICAgICAjIEBsb2FkICdoZXhpc2xlJ1xuICAgICAgICAjIEBsb2FkICd2b3Jvbm95J1xuICAgICAgICAjIEBsb2FkICdrcmFwJ1xuICAgICAgICAjIEBsb2FkICdrZXJsJ1xuICAgICAgICAjIEBsb2FkICdhcm15J1xuICAgICAgICAjIEBsb2FkICdib2lkcydcbiAgICAgICAgQGxvYWQgJ2FzdHJvJ1xuXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgc3RhcnRSZW5kZXJpbmc6IC0+XG5cbiAgICAgICAgQG1Jc1JlbmRlcmluZyA9IHRydWVcbiAgICAgICAgQHJlbmRlckxvb3AoKVxuICAgIFxuICAgIHJlbmRlckxvb3A6ID0+XG4gICAgICAgIFxuICAgICAgICBpZiBub3QgQG1HTENvbnRleHQgdGhlbiByZXR1cm5cblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgQHJlbmRlckxvb3BcblxuICAgICAgICBpZiBAbUlzUGF1c2VkIGFuZCBub3QgQG1Gb3JjZUZyYW1lXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIFxuICAgICAgICBAbUZvcmNlRnJhbWUgPSBmYWxzZVxuXG4gICAgICAgIHRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKVxuXG4gICAgICAgIGx0aW1lID0gMC4wXG4gICAgICAgIGR0aW1lID0gMC4wXG4gICAgICAgIGlmIEBtSXNQYXVzZWRcbiAgICAgICAgICAgIGx0aW1lID0gQG1UZlxuICAgICAgICAgICAgZHRpbWUgPSAxMDAwLjAgLyA2MC4wXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGx0aW1lID0gdGltZSAtIEBtVG9cbiAgICAgICAgICAgIGlmIEBtUmVzdGFydGVkXG4gICAgICAgICAgICAgICAgZHRpbWUgPSAxMDAwLjAvNjAuMFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGR0aW1lID0gbHRpbWUgLSBAbVRmIFxuICAgICAgICAgICAgQG1UZiA9IGx0aW1lXG4gICAgICAgIEBtUmVzdGFydGVkID0gZmFsc2VcblxuICAgICAgICBAbUVmZmVjdC5wYWludCBsdGltZS8xMDAwLjAsIGR0aW1lLzEwMDAuMCwgNjAsIEBtSXNQYXVzZWQgXG5cbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAgMDAwICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICByZXNpemU6ICh4cmVzLCB5cmVzKSA9PlxuXG4gICAgICAgIGlmIEBtQ2FudmFzXG4gICAgICAgICAgICBAbUNhbnZhcy53aWR0aCAgPSBAbUNhbnZhcy5vZmZzZXRXaWR0aFxuICAgICAgICAgICAgQG1DYW52YXMuaGVpZ2h0ID0gQG1DYW52YXMub2Zmc2V0SGVpZ2h0XG4gICAgICAgICAgICBAbUVmZmVjdC5zZXRTaXplIEBtQ2FudmFzLndpZHRoLCBAbUNhbnZhcy5oZWlnaHRcbiAgICAgICAgICAgIEBtRm9yY2VGcmFtZSA9IHRydWVcblxuICAgIGxvZ0Vycm9yczogKHJlc3VsdCkgLT4gbG9nIHJlc3VsdCBpZiByZXN1bHRcblxuICAgICMgMDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgXG4gICAgIyAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjICAgIDAwMCAgICAgMDAwMDAwMCAgICAgMDAwMDAgICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIFxuICAgICMgICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAgICAwMDAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBzZXRUZXh0dXJlOiAoc2xvdCwgdXJsKSAtPlxuXG4gICAgICAgIHJlcyA9IEBtRWZmZWN0Lm5ld1RleHR1cmUgQG1BY3RpdmVEb2MsIHNsb3QsIHVybFxuICAgICAgICBpZiBub3QgcmVzLm1GYWlsZWRcbiAgICAgICAgICAgIEBtUGFzc1tAbUFjdGl2ZURvY10ubURpcnR5ID0gcmVzLm1OZWVkc1NoYWRlckNvbXBpbGVcblxuICAgIGdldFRleHR1cmU6IChzbG90KSAtPlxuICAgICAgICBAbUVmZmVjdC5nZXRUZXh0dXJlKCBAbUFjdGl2ZURvYywgc2xvdCApXG5cbiAgICBzZXRTaGFkZXJGcm9tRWRpdG9yOiAoZm9yY2VhbGwpIC0+XG5cbiAgICAgICAgYW55RXJyb3JzID0gZmFsc2VcblxuICAgICAgICBudW0gPSBAbUVmZmVjdC5nZXROdW1QYXNzZXMoKVxuXG4gICAgICAgIHJlY29tcGlsZUFsbCA9IGZhbHNlXG4gICAgICAgIGZvciBpIGluIFswLi4ubnVtXVxuICAgICAgICAgICAgaWYgQG1FZmZlY3QuZ2V0UGFzc1R5cGUoaSkgPT0gJ2NvbW1vbicgYW5kIChAbVBhc3NbaV0ubURpcnR5IG9yIGZvcmNlYWxsKVxuICAgICAgICAgICAgICAgIHJlY29tcGlsZUFsbCA9IHRydWVcbiAgICAgICAgICAgICAgICBicmVha1xuXG4gICAgICAgIGZvciBqIGluIFswLi4uNF1cbiAgICAgICAgICAgIGZvciBpIGluIFswLi4ubnVtXVxuICAgICAgICAgICAgICAgIGlmIGogPT0gMCBhbmQgQG1FZmZlY3QuZ2V0UGFzc1R5cGUoaSkgIT0gJ2NvbW1vbicgICB0aGVuIGNvbnRpbnVlXG4gICAgICAgICAgICAgICAgaWYgaiA9PSAxIGFuZCBAbUVmZmVjdC5nZXRQYXNzVHlwZShpKSAhPSAnYnVmZmVyJyAgIHRoZW4gY29udGludWVcbiAgICAgICAgICAgICAgICBpZiBqID09IDIgYW5kIEBtRWZmZWN0LmdldFBhc3NUeXBlKGkpICE9ICdjdWJlbWFwJyAgdGhlbiBjb250aW51ZVxuICAgICAgICAgICAgICAgIGlmIGogPT0gMyBhbmQgQG1FZmZlY3QuZ2V0UGFzc1R5cGUoaSkgIT0gJ2ltYWdlJyAgICB0aGVuIGNvbnRpbnVlXG5cbiAgICAgICAgICAgICAgICBpZiByZWNvbXBpbGVBbGwgb3IgQG1QYXNzW2ldLm1EaXJ0eSBvciBmb3JjZWFsbFxuICAgICAgICAgICAgICAgICAgICBzaGFkZXJDb2RlID0gQG1QYXNzW2ldLm1Db2RlXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IEBtRWZmZWN0Lm5ld1NoYWRlciBzaGFkZXJDb2RlLCBpXG4gICAgICAgICAgICAgICAgICAgIGlmIHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICAgICAgYW55RXJyb3JzID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICBAbVBhc3NbaV0ubUVycm9yID0gcmVzdWx0XG4gICAgICAgICAgICAgICAgICAgIEBtUGFzc1tpXS5tRGlydHkgPSBmYWxzZVxuXG4gICAgICAgIEBsb2dFcnJvcnMgQG1QYXNzW0BtQWN0aXZlRG9jXS5tRXJyb3JcblxuICAgICAgICBpZiBub3QgYW55RXJyb3JzXG4gICAgICAgICAgICBpZiBub3QgQG1Jc1JlbmRlcmluZ1xuICAgICAgICAgICAgICAgIGdUb3kuc3RhcnRSZW5kZXJpbmcoKVxuICAgICAgICAgICAgQG1Gb3JjZUZyYW1lID0gdHJ1ZVxuXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMCAgMDAwICAwMDAgICAgICAgMDAwIDAgMDAwICBcbiAgICAjIDAwMCAwIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgIDAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAgICAgIDAwICBcbiAgICBcbiAgICBsb2FkTmV3OiAtPlxuICAgICAgICBAbG9hZFBhc3NlcyBbe1xuICAgICAgICAgICAgaW5wdXRzOiAgW11cbiAgICAgICAgICAgIHR5cGU6ICAgICdpbWFnZSdcbiAgICAgICAgICAgIGNvZGU6IFwiXCJcIlxuICAgICAgICAgICAgICAgIHZvaWQgbWFpbkltYWdlKCBvdXQgdmVjNCBmcmFnQ29sb3IsIGluIHZlYzIgZnJhZ0Nvb3JkIClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZlYzIgdXYgPSBmcmFnQ29vcmQvaVJlc29sdXRpb24ueHk7XG4gICAgICAgICAgICAgICAgICAgIHZlYzMgY29sID0gMC4xICsgMC4xKmNvcygwLjEqaVRpbWUrdXYueHl4K3ZlYzMoMCwyLDQpKTtcbiAgICAgICAgICAgICAgICAgICAgZnJhZ0NvbG9yID0gdmVjNChjb2wsMS4wKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXCJcIlwiXG4gICAgICAgIH1dXG4gICAgXG4gICAgbG9hZFBhc3NlczogKHBhc3NlcykgLT5cbiAgICAgICAgXG4gICAgICAgIHJlcyA9IEBtRWZmZWN0Lm5ld1NjcmlwdEpTT04gcGFzc2VzXG4gICAgICAgIFxuICAgICAgICAjIGtsb2cgJ3Bhc3NlcycgcGFzc2VzXG4gICAgICAgIFxuICAgICAgICBAbVBhc3MgPSBbXVxuICAgICAgICBcbiAgICAgICAgZm9yIGkgaW4gWzAuLi5yZXMubGVuZ3RoXVxuICAgICAgICAgICAgQG1QYXNzW2ldID0gXG4gICAgICAgICAgICAgICAgbUNvZGU6ICAgcmVzW2ldLm1TaGFkZXJcbiAgICAgICAgICAgICAgICBtRmFpbGVkOiByZXNbaV0ubUZhaWxlZFxuICAgICAgICAgICAgICAgIG1FcnJvcjogIHJlc1tpXS5tRXJyb3JcbiAgICAgICAgICAgICAgICBtRGlydHk6ICBmYWxzZVxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAbG9nRXJyb3JzIEBtUGFzc1swXS5tRXJyb3JcbiAgICAgICAgQHN0YXJ0UmVuZGVyaW5nKClcbiAgICAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIGxvYWQ6IChkaXIpIC0+XG4gICAgICAgIHNoYWRlckRpciA9IHNsYXNoLnJlc29sdmUgXCIje19fZGlybmFtZX0vLi4vc2hhZGVyLyN7ZGlyfVwiXG4gICAgICAgIGltYWdlRmlsZSA9IFwiI3tzaGFkZXJEaXJ9L2ltYWdlLmZyYWdcIlxuICAgICAgICByZXR1cm4gaWYgbm90IHNsYXNoLmZpbGVFeGlzdHMgaW1hZ2VGaWxlXG4gICAgICAgIHNoYWRlciA9IGltYWdlOmltYWdlRmlsZVxuICAgICAgICBmb3IgZmlsZSBpbiBbJ2NvbW1vbicgJ2J1ZmZlciddXG4gICAgICAgICAgICBpZiBzbGFzaC5maWxlRXhpc3RzIFwiI3tzaGFkZXJEaXJ9LyN7ZmlsZX0uZnJhZ1wiXG4gICAgICAgICAgICAgICAgc2hhZGVyW2ZpbGVdID0gXCIje3NoYWRlckRpcn0vI3tmaWxlfS5mcmFnXCJcbiAgICAgICAgICAgICAgICBcbiAgICAgICAga2xvZyAnbG9hZGluZyBzaGFkZXIgZGlyJyBzaGFkZXJcbiAgICAgICAgQGxvYWRTaGFkZXIgc2hhZGVyXG4gICAgXG4gICAgbG9hZFNoYWRlcjogKGltYWdlOiwgY29tbW9uOiwgYnVmZmVyOiwga2V5Ym9hcmQ6dHJ1ZSwgZm9udDp0cnVlKSAtPlxuICAgICAgICBcbiAgICAgICAgcGFzc2VzID0gW11cbiAgICAgICAgXG4gICAgICAgIGltYWdlQ29kZSA9IHNsYXNoLnJlYWRUZXh0IGltYWdlXG4gICAgICAgIGlmIGVtcHR5IGltYWdlQ29kZVxuICAgICAgICAgICAgcmV0dXJuIGVycm9yIFwibm8gaW1hZ2UgY29kZSBpbiAje2ltYWdlfT9cIlxuICAgICAgICBcbiAgICAgICAgcGFzc2VzLnB1c2hcbiAgICAgICAgICAgIHR5cGU6ICAgICdpbWFnZSdcbiAgICAgICAgICAgIGNvZGU6ICAgIGltYWdlQ29kZVxuICAgICAgICAgICAgaW5wdXRzOiAgW11cbiAgICAgICAgICAgIFxuICAgICAgICBpZiBjb21tb25cbiAgICAgICAgICAgIHBhc3Nlcy5wdXNoXG4gICAgICAgICAgICAgICAgdHlwZTogJ2NvbW1vbidcbiAgICAgICAgICAgICAgICBjb2RlOiBzbGFzaC5yZWFkVGV4dCBjb21tb25cbiAgICAgICAgICAgIFxuICAgICAgICBpZiBrZXlib2FyZFxuICAgICAgICAgICAgcGFzc2VzWzBdLmlucHV0cy5wdXNoIGNoYW5uZWw6MCBpZDowIHR5cGU6J2tleWJvYXJkJ1xuICAgICAgICAgICAgcGFzc2VzLnB1c2ggXG4gICAgICAgICAgICAgICAgdHlwZTogJ2ltYWdlJ1xuICAgICAgICAgICAgICAgIHVybDogbVR5cGU6ICdrZXlib2FyZCdcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgaWYgYnVmZmVyXG4gICAgICAgICAgICBwYXNzZXNbMF0uaW5wdXRzLnB1c2ggY2hhbm5lbDoxIGlkOididWZmZXJBJyB0eXBlOididWZmZXInXG4gICAgICAgICAgICBwYXNzZXMucHVzaFxuICAgICAgICAgICAgICAgIHR5cGU6ICAgJ2J1ZmZlcidcbiAgICAgICAgICAgICAgICBvdXRwdXQ6ICdidWZmZXJBJ1xuICAgICAgICAgICAgICAgIGNvZGU6ICBzbGFzaC5yZWFkVGV4dCBidWZmZXJcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgaWYgZm9udFxuICAgICAgICAgICAgcGFzc2VzWzBdLmlucHV0cy5wdXNoIGNoYW5uZWw6MiBpZDoyIHR5cGU6J3RleHR1cmUnIHNyYzpzbGFzaC5maWxlVXJsIFwiLi4vaW1nL2ZvbnQucG5nXCJcbiAgICAgICAgICAgIHBhc3Nlcy5wdXNoIFxuICAgICAgICAgICAgICAgIHR5cGU6ICAnaW1hZ2UnXG4gICAgICAgICAgICAgICAgdXJsOlxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dHVyZSdcbiAgICAgICAgICAgICAgICAgICAgc3JjOiAgc2xhc2guZmlsZVVybCBcIi4uL2ltZy9mb250LnBuZ1wiXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBsb2FkUGFzc2VzIHBhc3Nlc1xuICAgICAgICBcbiAgICBtb2R1bGUuZXhwb3J0cyA9IFRveVxuICAgICJdfQ==
//# sourceURL=../coffee/toy.coffee